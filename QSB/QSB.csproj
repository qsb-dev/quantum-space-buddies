<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <AssemblyTitle>Quantum Space Buddies</AssemblyTitle>
        <Description>Multiplayer mod for Outer Wilds</Description>
        <Product>Quantum Space Buddies</Product>
        <RunPostBuildEvent>OnBuildSuccess</RunPostBuildEvent>
        <ProjectGuid>{1F00090A-C697-4C55-B401-192F3CFB9DC2}</ProjectGuid>
        <OutputPath>bin\$(Configuration)\QSB</OutputPath>
        <OutputPath Condition="Exists($(OwmlDir))">$(OwmlDir)\Mods\QSB</OutputPath>
    </PropertyGroup>
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
        <DebugType>full</DebugType>
        <Optimize>true</Optimize>
    </PropertyGroup>
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
        <DebugType>pdbonly</DebugType>
    </PropertyGroup>
    <PropertyGroup>
        <PostBuildEvent Condition="Exists($(UnityAssetsDir)) and Exists($(GameDir)) and Exists($(OwmlDir))">
            :: weave qsb
            "$(SolutionDir)\MirrorWeaver\bin\$(Configuration)\MirrorWeaver" "$(OutputPath)\QSB.dll" "$(GameDir)"

            :: copy output to unity project
            copy /y "$(OutputPath)" "$(UnityAssetsDir)"
            :: copy game assembly to unity project
            copy /y "$(GameDir)\OuterWilds_Data\Managed\Assembly-CSharp.dll" "$(UnityAssetsDir)"
            copy /y "$(GameDir)\OuterWilds_Data\Managed\Assembly-CSharp-firstpass.dll" "$(UnityAssetsDir)"
            copy /y "$(GameDir)\OuterWilds_Data\Managed\Unity.InputSystem.dll" "$(UnityAssetsDir)"
            copy /y "$(GameDir)\OuterWilds_Data\Managed\EOS-SDK.dll" "$(UnityAssetsDir)"
            copy /y "$(GameDir)\OuterWilds_Data\Managed\UniSense.dll" "$(UnityAssetsDir)"

            :: copy owml files to unity project
            copy /y "$(OwmlDir)\Autofac.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Newtonsoft.Json.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\0Harmony.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\MonoMod.Utils.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\MonoMod.RuntimeDetour.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Mono.Cecil.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Mono.Cecil.Mdb.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Mono.Cecil.Pdb.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Mono.Cecil.Rocks.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\dnpatch.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\dnlib.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\Gameloop.Vdf.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\NAudio-Unity.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Common.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.Assets.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.Events.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.Menus.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.Input.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModHelper.Interaction.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Utils.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Common.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Logging.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.ModLoader.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Patcher.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.GameFinder.dll" "$(UnityAssetsDir)"
            copy /y "$(OwmlDir)\OWML.Abstractions.dll" "$(UnityAssetsDir)"
        </PostBuildEvent>
    </PropertyGroup>
    <ItemGroup>
        <None Include="default-config.json">
            <CopyToOutputDirectory>Always</CopyToOutputDirectory>
        </None>
        <None Include="manifest.json">
            <CopyToOutputDirectory>Always</CopyToOutputDirectory>
        </None>
    </ItemGroup>
    <ItemGroup>
        <PackageReference Include="OuterWildsGameLibs" Version="1.1.12.125" IncludeAssets="compile" />
        <ProjectReference Include="..\QuantumUNET\QuantumUNET.csproj" />
        <ProjectReference Include="..\Mirror\Mirror.csproj" />
        <PackageReference Include="HarmonyX" Version="2.8.0" IncludeAssets="compile" />
        <PackageReference Include="OWML" Version="2.3.1" IncludeAssets="compile" />
    </ItemGroup>
    <ItemGroup>
        <None Update="AssetBundles\*">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </None>
    </ItemGroup>
    <ItemGroup>
        <None Update="debugsettings.json">
            <CopyToOutputDirectory>Always</CopyToOutputDirectory>
        </None>
    </ItemGroup>
</Project>
